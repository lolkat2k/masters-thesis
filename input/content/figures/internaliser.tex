%%%% Compiler overview
\begin{tikzpicture}[
    every node/.style={font=\tiny},
    main node/.style={rectangle, draw, fill=light-gray, font=\tiny,
      minimum width=width("Defunctionaliser"),
      minimum height=2\baselineskip},
    inner node/.style={rectangle, anchor=north east, font=\tiny},
    node distance=5mm and 5mm
]
%% Main nodes
% Front-end
  \node[main node] (1) {Defunctoriser};
  \node[inner node, at=(1.north east)] {4a};

  \node[main node] (2) [right=of 1, align=center] {Monomorphiser};
  \node[inner node, at=(2.north east)] {4b};

  \node[main node] (3) [below=of 2] {Defunctionaliser};
  \node[inner node, at=(3.north east)] {4c};

  \node[main node] (4) [left=of 3] {Internaliser};
  \node[inner node, at=(4.north east)] {4d};

%% Shadow nodes
  \node [left=of 1, align=center] (start) {AST: \\ Source: Info};
  \node [left=of 4, align=center] (end) {AST: \\ Core: SOACS};

%% Arrows
% Front-end
\draw [->] (start) -- (1);
\draw [->] (1) -- (2);
\draw [->] (2) -- (3);
\draw [->] (3) -- (4);
\draw [->] (4) -- (end);

%% Enclosing boxes
% Front-end
\node[draw, dashed, rounded corners, color=black, fit={(1)(2)(3)(4)}
] (frontend) {};
\node [anchor=south, at=(frontend.north)] (frontlab) {Internaliser};
\end{tikzpicture}
%
